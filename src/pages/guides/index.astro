---
import { useStoryblokApi } from "@storyblok/astro";
import { getStoryblokImageDimensions } from "@utils";
import BaseLayout from "@layouts/BaseLayout.astro";
import PageTitle from "@components/PageTitle/PageTitle.astro";
import GuideCard from "@components/Card/GuideCard.astro";

const storyblokApi = useStoryblokApi();
const {
	data: { stories },
} = await storyblokApi.get("cdn/stories", {
	by_slugs: "guides/*",
	sort_by: "name:asc",
	version: import.meta.env.DEV ? "draft" : "published",
});
---

<BaseLayout title="Guides">
	<PageTitle title="Guides">
		<p>
			Here you can learn about the gameâ€™s systems, find helpful resources,
			and reference data that has been gathered.
		</p>
	</PageTitle>
	<div>
		<ul class="auto-grid" role="list">
			{
				stories.map((guide) => (
					<li>
						<GuideCard
							class="bs-full"
							title={guide.content.title}
							url={`/${guide.full_slug}`}
							category={guide.content.category[0]}
						>
							<p slot="summary">{guide.content.summary}</p>
							<img
								slot="img"
								src={guide.content.cover_image.filename}
								alt={guide.content.cover_image.alt}
								width={
									getStoryblokImageDimensions(
										guide.content.cover_image.filename
									).width
								}
								height={
									getStoryblokImageDimensions(
										guide.content.cover_image.filename
									).height
								}
								loading="lazy"
								decoding="async"
							/>
						</GuideCard>
					</li>
				))
			}
		</ul>
	</div>
</BaseLayout>
